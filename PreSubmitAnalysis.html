<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="requiredJobs">
    <canvas id="Required Jobs" height="500" width="2000"></canvas>
</div>
<div id="optionalJobs" style="height: 50%">
    <canvas id="Optional Jobs" height="500" width="2000"></canvas>
</div>
<script>
    fetch('presubmit_jobs.json')
        .then(response => response.json())
        .then(data => {
            // get all jobs
            var allJobs = data.filter(job => job.Name)
            var maxJobNameLength = Math.max(...allJobs.map(job => job.Name.length));

            // Required Jobs are AlwaysRun:true and Optional:false
            var filteredDataRequiredJobs = data.filter(job => job.AlwaysRun && !job.Optional);

            // Sort jobs by pass rate
            filteredDataRequiredJobs.sort((a, b) => b.PassRate - a.PassRate);

            var jobNames = filteredDataRequiredJobs.map(job => job.Name.padStart(maxJobNameLength, '_'));
            var passRates = filteredDataRequiredJobs.map(job => job.PassRate);

            // Set the height of the chart container based on the number of requiredJobs
            var requiredJobs = document.getElementById('requiredJobs');
            requiredJobs.style.height = (filteredDataRequiredJobs.length * 20) + 'px';
            requiredJobs.style.width = '2000px'

            var ctx = document.getElementById('Required Jobs').getContext('2d');
            var gradientFill = ctx.createLinearGradient(0, 0, 0, requiredJobs.offsetHeight);
            gradientFill.addColorStop(1, 'rgba(255, 0, 0, 0.5)');  // End color (red)
            gradientFill.addColorStop(0, 'rgba(0, 255, 0, 0.5)');  // Start color (green)

            new Chart(ctx, {
                type: 'bar',  // Use 'bar' type
                data: {
                    labels: jobNames,
                    datasets: [{
                        label: 'Required Jobs',
                        data: passRates,
                        backgroundColor: gradientFill,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',  // Set indexAxis to 'y' for horizontal bars
                    responsive: true,  // Make the chart responsive
                    maintainAspectRatio: false,  // Allow the chart to fill its container
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    },
                }
            });

            // Optional jobs are AlwaysRun:true and Optional:true
            var filteredDataOptionalJobs = data.filter(job => job.AlwaysRun && job.Optional);

            // Sort jobs by pass rate
            filteredDataOptionalJobs.sort((a, b) => b.PassRate - a.PassRate);

            var jobNames = filteredDataOptionalJobs.map(job => job.Name.padStart(maxJobNameLength, '_'));
            var passRates = filteredDataOptionalJobs.map(job => job.PassRate);

            // Set the height of the chart container based on the number of optionalJobs
            var optionalJobs = document.getElementById('optionalJobs');
            optionalJobs.style.height = (filteredDataOptionalJobs.length * 20) + 'px';
            optionalJobs.style.width = '2000px'

            var ctx2 = document.getElementById('Optional Jobs').getContext('2d');
            var gradientFill2 = ctx2.createLinearGradient(0, 0, 0, optionalJobs.offsetHeight);
            gradientFill2.addColorStop(1, 'rgba(255, 0, 0, 0.5)');  // End color (red)
            gradientFill2.addColorStop(0, 'rgba(0, 255, 0, 0.5)');  // Start color (green)

            new Chart(ctx2, {
                type: 'bar',  // Use 'bar' type
                data: {
                    labels: jobNames,
                    datasets: [{
                        label: 'Optional Jobs',
                        data: passRates,
                        backgroundColor: gradientFill2,  // Use gradientFill2 for the fill color
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',  // Set indexAxis to 'y' for horizontal bars
                    responsive: true,  // Make the chart responsive
                    maintainAspectRatio: false,  // Allow the chart to fill its container
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    }
                }
            });
        });
</script>
</body>
</html>
