<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

</head>
<body>
<div id="requiredJobs">
    <canvas id="Required Jobs"></canvas>
</div>
<div id="optionalJobs">
    <canvas id="Optional Jobs"></canvas>
</div>
<script>
    fetch('presubmit_jobs.json')
        .then(response => response.json())
        .then(data => {
            // Required Jobs are AlwaysRun:true and Optional:false
            var filteredDataRequiredJobs = data.filter(job => job.AlwaysRun && !job.Optional);

            // Sort jobs by pass rate
            filteredDataRequiredJobs.sort((a, b) => b.PassRate - a.PassRate);

            var jobNames = filteredDataRequiredJobs.map(job => job.Name);
            var passRates = filteredDataRequiredJobs.map(job => job.PassRate);

            var requiredJobs = document.getElementById('requiredJobs');
            requiredJobs.style.height = '500px';
            requiredJobs.style.width = '2000px'

            var ctx = document.getElementById('Required Jobs').getContext('2d');
            var gradientFill = ctx.createLinearGradient(0, 0, 0, requiredJobs.offsetHeight);
            gradientFill.addColorStop(1, 'rgba(255, 0, 0, 1.0)');  // End color (red)
            gradientFill.addColorStop(0, 'rgba(0, 255, 0, 1.0)');  // Start color (green)

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: jobNames,
                    datasets: [{
                        label: 'Required Jobs',
                        data: passRates,
                        backgroundColor: gradientFill,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        barThickness: 100
                    }]
                },
                options: {
                    indexAxis: 'x',  // Set indexAxis to 'y' for horizontal bars
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Required Jobs',
                            font: {
                                size: 36,
                                weight: 'bold'
                            }
                        }
                    }
                }
            });

            // Optional jobs are AlwaysRun:true and Optional:true
            var filteredDataOptionalJobs = data.filter(job => job.AlwaysRun && job.Optional);

            // Sort jobs by pass rate
            filteredDataOptionalJobs.sort((a, b) => b.PassRate - a.PassRate);

            var jobNames = filteredDataOptionalJobs.map(job => job.Name);
            var passRates = filteredDataOptionalJobs.map(job => job.PassRate);

            var optionalJobs = document.getElementById('optionalJobs');
            optionalJobs.style.height = '500px';
            optionalJobs.style.width = '2000px'

            var ctx2 = document.getElementById('Optional Jobs').getContext('2d');
            var gradientFill2 = ctx2.createLinearGradient(0, 0, 0, optionalJobs.offsetHeight);
            gradientFill2.addColorStop(1, 'rgba(255, 0, 0, 1.0)');  // End color (red)
            gradientFill2.addColorStop(0, 'rgba(0, 255, 0, 1.0)');  // Start color (green)

            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: jobNames,
                    datasets: [{
                        label: '',
                        data: passRates,
                        backgroundColor: gradientFill2,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        barThickness: 100
                    }]
                },
                options: {
                    indexAxis: 'x',  // Set indexAxis to 'y' for horizontal bars
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Optional Jobs',
                            font: {
                                size: 36,
                                weight: 'bold'
                            }
                        },
                    }
                }
            });
        });
</script>
</body>
</html>
